# git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm

# UI
bg="#181816"
set -g @black0 "#12120f"
set -g @black1 "#0d0c0c"
set -g @black2 "#282727"
set -g @black3 "#393836"
set -g @black4 "$bg"
set -g @white "#c5c9c5"
set -g @red "#c4746e"
set -g @yellow "#c4b28a"
set -g @grey "#a6a69c"
set -g @tmux_banner "#[bg=#{?client_prefix,#{@yellow},#{@black3}},fg=#{?client_prefix,#{@black3},#{@white}}] TMUX #[bg=default,fg=default]"
set -g @session_banner "#[bg=#{@black2},fg=#{@white}] #{session_name} #[bg=default,fg=default]"
set -g @hostname "#[bg=#{@black3},fg=#{@white}] #{host} #[bg=default,fg=default]"
set -g @zoom_status "#[bg=#{@red},fg=#{@black2}]#{?window_zoomed_flag, ZOOMED ,}#[bg=default,fg=default]"
set -g @date "#[bg=#{@black2},fg=#{@white}] %d/%b/%y #[bg=default,fg=default]"
set -g @time "#[bg=#{@black3},fg=#{@white}] %I:%M %p #[bg=default,fg=default]"
set -g @basename_path "#[bg=#{@black3},fg=#{@white}] #(basename #{pane_current_path}) #[bg=default,fg=default]"
set -g @bash_warning "#[bg=#{@red},fg=#{@black2}]#(~/.local/scripts/bin/tmux_check_bash.sh)#[bg=default,fg=default]"
set -g @marked "#[bg=#{@black2},fg=#{@red}]#{?#{m/r:^M: ,#{pane_title}}, M ,}#[bg=default,fg=default]"
set -g set-titles-string "TMUX"
set -g allow-set-title off
set -g detach-on-destroy no-detached
set -g status-left "#{E:@bash_warning}#{E:@tmux_banner}#{E:@session_banner}#{E:@hostname}#{E:@zoom_status}#{E:@marked}"
set -g status-right "#{E:@forward_prefix}#{E:@time}#{E:@date}#{E:@basename_path}"
set -g status-right-length 60
set -g status-position top
set -g status-justify absolute-centre
set -g status-left-length 60
set -g status-style bg="none",fg="#{@white}"
set -g status-right-style bg=terminal,fg=terminal
set -g status-left-style bg=terminal,fg=terminal
set -g window-status-format "#[bg=none,fg=#{@white}] #I #W "
set -g window-status-current-format "#[bg=#{@black3},fg=#{@white}] #I #W "
set -g window-status-separator ""
set -g pane-border-lines heavy
set -g pane-border-indicators colour
set -g pane-border-format "#{pane_current_path}"
set -g pane-border-style fg="#{@black3}"
set -g pane-active-border-style fg="#{@yellow}"
set -g pane-border-status off
set -g popup-style bg="#{@black2}"
set -g popup-border-style fg="#{@black2}",bg="#{@black2}"
set -g popup-border-lines none
set -g menu-style bg="#{@black2}"
set -g menu-selected-style bg="#{@red}",fg="#{@black2}"
set -g menu-border-style fg="#{@black2}",bg="#{@black2}"
set -g message-style bg="#{@red}",fg="#{@black2}"
set-environment -gF FZF_DEFAULT_OPTS \
  '--ellipsis=... \
  --border=block \
  --layout=reverse \
  --prompt="" \
  --height="100%" \
  --preview-window=border-none \
  --marker="" \
  --marker-multi-line="" \
  --info=inline-right \
  --pointer="" \
  --no-bold \
  --no-header-lines-border \
  --color="bg:#{@black2},border:#{@black2},label:#{@red},gutter:#{@black2},pointer:#{@black2},hl:#{@white},hl+:#{@white},bg+:#{@red},fg:#{@white},fg+:#{@black2},header:#{@white},prompt:#{@white},query:#{@white}" \
  --cycle \
  --bind="down:preview-down,up:preview-up" \
  --no-scrollbar'


# CONFIGURATION
set -gu @forward_prefix
set -g prefix C-x
set -sg escape-time 0
set -g mouse on
set -g status-keys vi
set -g mode-keys vi
set -g renumber-windows on
set -g base-index 1
set -g display-time 0
set -g main-pane-width "50%"
set -g main-pane-height "50%"
set -g history-limit 10000

# KEYBINDINGS
unbind -T root M-MouseDown3Pane
unbind -T root MouseDown3Pane
unbind -T root MouseDragEnd1Pane
unbind -T copy-mode-vi MouseDragEnd1Pane
unbind -T copy-mode MouseDragEnd1Pane
unbind /
bind -T root MouseDragEnd1Pane send-keys -X copy-pipe-no-clear
bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-no-clear
bind C-x send-prefix
bind c new-window -a -c "#{pane_current_path}"
bind v split-window -c "#{pane_current_path}" -h
bind s split-window -c "#{pane_current_path}" -v
bind J swap-pane -U
bind K swap-pane -D
bind H swap-window -t -1\; select-window -t -1
bind L swap-window -t +1\; select-window -t +1
bind 0 run-shell ~/.local/scripts/bin/tmux_select_last_window.sh
bind '|' resize-pane -Z
bind N run-shell ~/.local/scripts/bin/tmux_new_session.sh
bind C-o switch-client -l
bind C-a select-window -l
bind C-n select-window -n
bind C-p select-window -p
bind . run-shell ~/.local/scripts/bin/tmux_swap_pane.sh
bind f display-panes -d 0
bind C-b run-shell ~/.local/scripts/bin/tmux_toggle_prefix.sh
bind Space run-shell ~/.local/scripts/bin/tmux_run_menu.sh
bind C-Space run-shell ~/.local/scripts/bin/tmux_gemma.sh
bind O run-shell ~/.local/scripts/bin/tmux_kill_panes.sh
bind o display-popup -s bg="$bg" -h 10 -y 15% -EE ~/.local/scripts/bin/tmux_switch_session.sh
bind + display-popup -h 10 -y 15% -EE ~/.local/scripts/bin/tmux_layout_selector.sh
bind M run-shell ~/.local/scripts/bin/tmux_spotify.sh
bind ñ run-shell ~/.local/scripts/bin/tmux_goto_todo.sh
bind R run-shell ~/.local/scripts/bin/tmux_reload.sh
bind r run-shell ~/.local/scripts/bin/tmux_resize.sh
bind , run-shell ~/.local/scripts/bin/tmux_rename_window.sh
bind ";" run-shell ~/.local/scripts/bin/tmux_rename_session.sh
bind g run-shell ~/.local/scripts/bin/tmux_mark.sh
bind G run-shell ~/.local/scripts/bin/tmux_mark_rm.sh
bind m run-shell ~/.local/scripts/bin/tmux_mark_list.sh
bind "'" run-shell ~/.local/scripts/bin/tmux_mark_prev.sh
bind ¿ run-shell ~/.local/scripts/bin/tmux_mark_next.sh
bind -T copy-mode-vi Escape send-keys -X cancel
bind -T copy-mode-vi y send-keys -X copy-selection
bind -T copy-mode-vi g send-keys -X top-line
bind -T copy-mode-vi G send-keys -X bottom-line
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi V send-keys -X select-line
bind -T copy-mode-vi / run-shell ~/.local/scripts/bin/tmux_search_backwards.sh
bind -T copy-mode-vi ? run-shell ~/.local/scripts/bin/tmux_search_forwards.sh

is_vim="echo '#{pane_current_command}' | grep -iqE '^n?vim$'"
bind h if-shell "$is_vim" 'send-keys Space wh'  'select-pane -L'
bind j if-shell "$is_vim" 'send-keys Space wj'  'select-pane -D'
bind k if-shell "$is_vim" 'send-keys Space wk'  'select-pane -U'
bind l if-shell "$is_vim" 'send-keys Space wl'  'select-pane -R'
bind C-h if-shell "$is_vim" 'send-keys Space wh'  'select-pane -L'
bind C-j if-shell "$is_vim" 'send-keys Space wj'  'select-pane -D'
bind C-k if-shell "$is_vim" 'send-keys Space wk'  'select-pane -U'
bind C-l if-shell "$is_vim" 'send-keys Space wl'  'select-pane -R'

set -g @continuum-restore 'on'
set -g @continuum-save-interval '15'

set -g @resurrect-processes 'false'

set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

run '~/.tmux/plugins/tpm/tpm'
